

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Usage &mdash; luksipc 0.04 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="luksipc 0.04 documentation" href="index.html"/>
        <link rel="next" title="Conversion problems" href="problems.html"/>
        <link rel="prev" title="Introduction" href="introduction.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="index.html" class="icon icon-home"> luksipc
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <p class="caption"><span class="caption-text">luksipc Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#authors">Authors</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#disclaimer">Disclaimer</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#compiling">Compiling</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#checklist">Checklist</a></li>
<li class="toctree-l2"><a class="reference internal" href="#preparation">Preparation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#plain-to-luks-conversion">Plain to LUKS conversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="#luks-to-luks-conversion">LUKS to LUKS conversion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="problems.html">Conversion problems</a><ul>
<li class="toctree-l2"><a class="reference internal" href="problems.html#problems-during-plain-to-luks-conversion">Problems during plain to LUKS conversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="problems.html#problems-during-luks-to-luks-conversion">Problems during LUKS to LUKS conversion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">luksipc</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Usage</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/usage.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h1>
<p>The following section will now cover the basic usage of luksipc. There are two
distinct cases, one is the conversion of a unencrypted (plain) volume to LUKS
and the other is the conversion of an encrypted (LUKS) volume to another LUKS
volume. Both will need the same preparation steps before performing them.</p>
<div class="section" id="checklist">
<h2>Checklist<a class="headerlink" href="#checklist" title="Permalink to this headline">¶</a></h2>
<p>If you skip over everything else, <strong>please</strong> at least make sure you do these
steps before starting a conversion:</p>
<blockquote>
<div><ul class="simple">
<li>Resized file system size, shrunk size by at least 10 MiB</li>
<li>Unmounted file system</li>
<li>Laptop is connected to A/C power (if applicable)</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="preparation">
<span id="id1"></span><h2>Preparation<a class="headerlink" href="#preparation" title="Permalink to this headline">¶</a></h2>
<p>The first thing you need to do is resize your file system to accomodate for the
fact that the device is going to be a tiny bit smaller in the end (due to the
LUKS header). The LUKS header size is usually 2048 kiB (it was 1028 kiB for
previous versions of cryptsetup), but you can safely decrease the file system
size by more (like 100 MiB) to be on the safe side.  If you decrease the size
too much you have no drawbacks (and you can easily increase after the
conversion has been performed).</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Do not forget to shrink the file system before conversion</p>
</div>
<p>luksipc has no means of detecting wheter or not you have performed this step
and will not warn you if you haven&#8217;t (it has no knowledge of the underlying
file system). This might lead to very weird file system errors in the case that
your volume ever wants to use the whole space and it might even render your
volume completely unmountable (depending on the check the file system driver
performs on the block device before allowing mounting).</p>
<p>For example, let&#8217;s say you have a device at /dev/loop0 that has an ext4 file
system. You want to LUKSify it. We first resize our volume. For this we find
out how large the volume is currently:</p>
<div class="highlight-python"><div class="highlight"><pre># tune2fs -l /dev/loop0
tune2fs 1.42.9 (4-Feb-2014)
Filesystem volume name:   &lt;none&gt;
Last mounted on:          &lt;not available&gt;
Filesystem UUID:          713cc62e-b2a2-406a-a82a-c4c1d01464e1
Filesystem magic number:  0xEF53
Filesystem revision #:    1 (dynamic)
Filesystem features:      has_journal ext_attr resize_inode dir_index filetype extent flex_bg sparse_super large_file huge_file uninit_bg dir_nlink extra_isize
Filesystem flags:         signed_directory_hash
Default mount options:    user_xattr acl
Filesystem state:         clean
Errors behavior:          Continue
Filesystem OS type:       Linux
Inode count:              64000
Block count:              256000
Reserved block count:     12800
Free blocks:              247562
Free inodes:              63989
First block:              0
Block size:               4096
[...]
</pre></div>
</div>
<p>So we now know that our device is 256000 blocks of 4096 bytes each, so exactly
1000 MiB. We verify this is correct (it is in this case). So we now want to
decrease the file system size to 900 MiB. 900 MiB = 900 * 1024 * 1024 bytes =
943718400 bytes. With a file system block size of 4096 bytes we arrive at
943718400 / 4096 = 230400 blocks for the file system with decreased size. So we
resize the file system:</p>
<div class="highlight-python"><div class="highlight"><pre># resize2fs /dev/loop0 230400
resize2fs 1.42.9 (4-Feb-2014)
Resizing the filesystem on /dev/loop0 to 230400 (4k) blocks.
The filesystem on /dev/loop0 is now 230400 blocks long.
</pre></div>
</div>
<p>That was successful. Perfect. Now (if you haven&#8217;t already), umount the volume.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Do not forget to unmount the file system before conversion</p>
</div>
</div>
<div class="section" id="plain-to-luks-conversion">
<h2>Plain to LUKS conversion<a class="headerlink" href="#plain-to-luks-conversion" title="Permalink to this headline">¶</a></h2>
<p>After having done the preparation as described in the <a class="reference internal" href="#preparation"><span>Preparation</span></a>
subsection, we can proceed to LUKSify the device. By default the initial
randomized key is read from /dev/urandom and written to
/root/initial_keyfile.bin. This is okay for us, we will remove the appropriate
keyslot for this random key anyways in the future.  It is only used for
bootstrapping. We start the conversion:</p>
<div class="highlight-python"><div class="highlight"><pre># ./luksipc -d /dev/loop0
WARNING! luksipc will perform the following actions:
   =&gt; Normal LUKSification of plain device /dev/loop0
   -&gt; luksFormat will be performed on /dev/loop0

Please confirm you have completed the checklist:
    [1] You have resized the contained filesystem(s) appropriately
    [2] You have unmounted any contained filesystem(s)
    [3] You will ensure secure storage of the keyfile that will be generated at /root/initial_keyfile.bin
    [4] Power conditions are satisfied (i.e. your laptop is not running off battery)
    [5] You have a backup of all important data on /dev/loop0

    /dev/loop0: 1024 MiB = 1.0 GiB
    Chunk size: 10485760 bytes = 10.0 MiB
    Keyfile: /root/initial_keyfile.bin
    LUKS format parameters: None given

Are all these conditions satisfied, then answer uppercase yes:
</pre></div>
</div>
<p>Please, read the whole message thourougly. There is no going back from this. If
and only if you&#8217;re 100% sure that all preconditions are satisfied, answer
&#8220;YES&#8221; and press return:</p>
<div class="highlight-python"><div class="highlight"><pre>Are all these conditions satisfied, then answer uppercase yes: YES
[I]: Created raw device alias: /dev/loop0 -&gt; /dev/mapper/alias_luksipc_raw_89ee2dc8
[I]: Size of reading device /dev/loop0 is 1073741824 bytes (1024 MiB + 0 bytes)
[I]: Backing up physical disk /dev/loop0 header to backup file header_backup.img
[I]: Performing luksFormat of /dev/loop0
[I]: Performing luksOpen of /dev/loop0 (opening as mapper name luksipc_7a6bfc08)
[I]: Size of luksOpened writing device is 1071644672 bytes (1022 MiB + 0 bytes)
[I]: Write disk smaller than read disk by 2097152 bytes (2048 kB + 0 bytes, occupied by LUKS header)
[I]: Starting copying of data, read offset 10485760, write offset 0
[I]:  0:00:  10.8%       110 MiB / 1022 MiB     0.0 MiB/s   Left:     912 MiB  0:00 h:m
[I]:  0:00:  20.5%       210 MiB / 1022 MiB     0.0 MiB/s   Left:     812 MiB  0:00 h:m
[I]:  0:00:  30.3%       310 MiB / 1022 MiB     0.0 MiB/s   Left:     712 MiB  0:00 h:m
[I]:  0:00:  40.1%       410 MiB / 1022 MiB     0.0 MiB/s   Left:     612 MiB  0:00 h:m
[I]:  0:00:  49.9%       510 MiB / 1022 MiB   412.0 MiB/s   Left:     512 MiB  0:00 h:m
[I]:  0:00:  59.7%       610 MiB / 1022 MiB   402.4 MiB/s   Left:     412 MiB  0:00 h:m
[I]:  0:00:  69.5%       710 MiB / 1022 MiB   401.5 MiB/s   Left:     312 MiB  0:00 h:m
[I]:  0:00:  79.3%       810 MiB / 1022 MiB   360.4 MiB/s   Left:     212 MiB  0:00 h:m
[I]:  0:00:  89.0%       910 MiB / 1022 MiB   350.0 MiB/s   Left:     112 MiB  0:00 h:m
[I]:  0:00:  98.8%      1010 MiB / 1022 MiB   344.8 MiB/s   Left:      12 MiB  0:00 h:m
[I]: Disk copy completed successfully.
[I]: Synchronizing disk...
[I]: Synchronizing of disk finished.
</pre></div>
</div>
<p>The volume was successfully converted! Now let&#8217;s first add a passphrase that we
want to use for the volume (or any other method of key, your choice). You can
actually even do this while the copying process is running:</p>
<div class="highlight-python"><div class="highlight"><pre># cryptsetup luksAddKey /dev/loop0 --key-file=/root/initial_keyfile.bin
Enter new passphrase for key slot:
Verify passphrase:
</pre></div>
</div>
<p>Let&#8217;s check this worked:</p>
<div class="highlight-python"><div class="highlight"><pre># cryptsetup luksDump /dev/loop0
LUKS header information for /dev/loop0

Version:        1
Cipher name:    aes
Cipher mode:    xts-plain64
Hash spec:      sha1
Payload offset: 4096
MK bits:        256
MK digest:      b2 34 b8 7b 70 e8 78 17 a4 12 00 41 dc a4 bc 70 a3 50 02 22
MK salt:        ee 25 b4 f0 11 94 25 d1 2b 97 42 6c a6 ff 3d 1d
                e7 6d 1e 15 dd a0 07 17 25 82 d1 f9 14 6c ab e9
MK iterations:  50125
UUID:           3e21bbe0-3d70-4189-8f19-04fb7d7c5bb9

Key Slot 0: ENABLED
    Iterations:             201892
    Salt:                   9d b6 a1 f5 0f 91 ee 24 be 49 0e f7 f9 62 a2 06
                            aa 45 79 7f 1a 56 5c 8c a3 03 15 a0 d2 9e ca e5
    Key material offset:    8
    AF stripes:             4000
Key Slot 1: ENABLED
    Iterations:             198756
    Salt:                   46 b4 21 fb e3 12 54 18 ff 8d 05 24 75 fc 3c 4b
                            3c 90 77 47 43 b6 0b 28 d9 b6 86 44 30 9e 20 d2
    Key material offset:    264
    AF stripes:             4000
Key Slot 2: DISABLED
Key Slot 3: DISABLED
Key Slot 4: DISABLED
Key Slot 5: DISABLED
Key Slot 6: DISABLED
Key Slot 7: DISABLED
</pre></div>
</div>
<p>You can see the initial keyfile (slot 0) and the passphrase we just added (slot
1). Let&#8217;s scrub the initial keyslot so the initial keyfile becomes useless. We
do this by scrubbing slot 0. Don&#8217;t worry, you cannot choose the wrong slot
here; cryptsetup won&#8217;t permit you to remove the wrong slot since you must prove
that you still have at least access to one remaining slot (by entering your
passphrase):</p>
<div class="highlight-python"><div class="highlight"><pre># cryptsetup luksKillSlot /dev/loop0 0
Enter any remaining passphrase:
</pre></div>
</div>
<p>And check again:</p>
<div class="highlight-python"><div class="highlight"><pre># cryptsetup luksDump /dev/loop0
LUKS header information for /dev/loop0

Version:        1
Cipher name:    aes
Cipher mode:    xts-plain64
Hash spec:      sha1
Payload offset: 4096
MK bits:        256
MK digest:      b2 34 b8 7b 70 e8 78 17 a4 12 00 41 dc a4 bc 70 a3 50 02 22
MK salt:        ee 25 b4 f0 11 94 25 d1 2b 97 42 6c a6 ff 3d 1d
                e7 6d 1e 15 dd a0 07 17 25 82 d1 f9 14 6c ab e9
MK iterations:  50125
UUID:           3e21bbe0-3d70-4189-8f19-04fb7d7c5bb9

Key Slot 0: DISABLED
Key Slot 1: ENABLED
    Iterations:             198756
    Salt:                   46 b4 21 fb e3 12 54 18 ff 8d 05 24 75 fc 3c 4b
                            3c 90 77 47 43 b6 0b 28 d9 b6 86 44 30 9e 20 d2
    Key material offset:    264
    AF stripes:             4000
Key Slot 2: DISABLED
Key Slot 3: DISABLED
Key Slot 4: DISABLED
Key Slot 5: DISABLED
Key Slot 6: DISABLED
Key Slot 7: DISABLED
</pre></div>
</div>
<p>Perfect, only our slot 1 (passphrase) is left now, you can safely discard the
initial_keyfile.bin now.</p>
<p>Last step, resize the filesystem to its original size. For this we must first
mount the cryptographic file system and then call the resize2fs utility again:</p>
<div class="highlight-python"><div class="highlight"><pre># cryptsetup luksOpen /dev/loop0 newcryptofs
Enter passphrase for /dev/loop0:

# resize2fs /dev/mapper/newcryptofs
resize2fs 1.42.9 (4-Feb-2014)
Resizing the filesystem on /dev/mapper/newcryptofs to 255488 (4k) blocks.
The filesystem on /dev/mapper/newcryptofs is now 255488 blocks long.
</pre></div>
</div>
<p>You can see that the filesystem now occupies all available space (998 MiB).</p>
</div>
<div class="section" id="luks-to-luks-conversion">
<h2>LUKS to LUKS conversion<a class="headerlink" href="#luks-to-luks-conversion" title="Permalink to this headline">¶</a></h2>
<p>There are situations in which you might want to re-encrypt your LUKS device.
For example, let&#8217;s say you have a cryptographic volume and multiple users have
access to it, each with their own keyslot. Now suppose you forfeit the rights
of one person to the volume. Technically you would do this by killing the
appropriate key slot of the key that was assigned to the user. This means the
user can from then on not unlock the volume using the LUKS keyheader.</p>
<p>But suppose the user you want whose access you want to revoke had &#8211; while
still in possession of a valid key &#8211; access to the file system container
itself. Then with that LUKS header he can still (even when the slot was killed)
derive the underlying cryptographic key that secures the data. The only way to
remedy this is to reencrypt the whole volume with a different bulk-encryption
key.</p>
<p>Another usecase are old LUKS volumes: the algorithms that were used at creation
may not be suitable anymore. For example, maybe you have switched to some other
hardware platform that has hardware support for specific algorithms and you can
only take advantage of those when you choose a specific encryption algorithm.
Or maybe the alignment that was adequate a couple of years back is not adquate
anymore for you. For example, older cryptsetup instances used 1028 kiB headers,
which is an odd size. Or maybe LUKS gained new features that you want to use.</p>
<p>In any case, there are numerous cases why you want to turn a LUKS volume into
another LUKS volume. This process is called &#8220;reLUKSification&#8221; within luksipc
and it is something that is supported from 0.03 onwards.</p>
<p>Let&#8217;s say you have a partition called /dev/sdh2 which you want to reLUKSify.
First let&#8217;s see what the used encryption parameters are:</p>
<div class="highlight-python"><div class="highlight"><pre># cryptsetup luksDump /dev/sdh2
LUKS header information for /dev/sdh2

Version:        1
Cipher name:    aes
Cipher mode:    xts-plain64
Hash spec:      sha1
Payload offset: 4096
MK bits:        256
MK digest:      b1 44 6a 73 e3 06 27 27 a2 fe c2 59 e5 3a 39 2e 15 d7 d7 e0
MK salt:        09 6d 6a 24 66 28 43 f7 f3 55 a9 9d 0a 40 77 58
                e0 1f 7c 30 b9 63 96 eb 99 34 52 4f 72 ba 57 ac
MK iterations:  49750
UUID:           6495d24d-34ac-41f5-a594-c5058cc31ed3

Key Slot 0: ENABLED
    Iterations:             206119
    Salt:                   99 c8 48 50 c3 a6 83 0d f9 39 a4 4d 0a 35 b0 ab
                            13 83 ee fd 9f 91 8d 92 a6 cf 42 50 9b 89 a6 be
    Key material offset:    8
    AF stripes:             4000
Key Slot 1: DISABLED
Key Slot 2: DISABLED
Key Slot 3: DISABLED
Key Slot 4: DISABLED
Key Slot 5: DISABLED
Key Slot 6: DISABLED
Key Slot 7: DISABLED
</pre></div>
</div>
<p>We&#8217;ll now open the device with our old key (a passphrase):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># cryptsetup luksOpen /dev/sdh2 oldluks</span>
</pre></div>
</div>
<p>Just for demonstration purposes, we can calculate the MD5SUM over the whole
block device (you won&#8217;t need to do that, it&#8217;s just a demo):</p>
<div class="highlight-python"><div class="highlight"><pre># md5sum /dev/mapper/oldluks
48d9763be76ddb4fb990367f8d6b8c22  /dev/mapper/oldluks
</pre></div>
</div>
<p>For reLUKSification to work, you need to supply the path to the unlocked device
(from where data will be read) as well as the path to the underlying raw device
(which will be luksFormatted).</p>
<p>You currently have your (raw) disk at /dev/sdh2 and your (unlocked) read disk
at /dev/mapper/oldluks. It may be possible that a new LUKS header is even
larger than the old header as now, which will lead to truncation of data at the
very end of the partition. This will be the case, for example, if you reLUKSify
volumes that have a 1028 kiB LUKS header and recreate with a recent version
which writes 2048 kiB LUKS headers. You need to take all measures to decrease
the size of the contained file system, as shown in <a class="reference internal" href="#preparation"><span>Preparation</span></a>.  These
steps will not be repeated here, but you <strong>must</strong> perform them nevertheless if
you want to avoid losing data.</p>
<p>After the disk is unlocked, you call luksipc. In addition to the raw device
which you want to convert you will also now have to specify the block device
name of the unlocked device. The raw device is the one that luksFormat and
luksOpen will be called on and the read device is the device from which data
will be read during the copy procedure. Here&#8217;s how the call to luksipc looks
like. We assume that we want to change the underlying hash function to SHA256:</p>
<div class="highlight-python"><div class="highlight"><pre># luksipc --device /dev/sdh2 --readdev /dev/mapper/oldluks --luksparams=&#39;-h,sha256&#39;
WARNING! luksipc will perform the following actions:
   =&gt; reLUKSification of LUKS device /dev/sdh2
   -&gt; Which has been unlocked at /dev/mapper/oldluks
   -&gt; luksFormat will be performed on /dev/sdh2

Please confirm you have completed the checklist:
    [1] You have resized the contained filesystem(s) appropriately
    [2] You have unmounted any contained filesystem(s)
    [3] You will ensure secure storage of the keyfile that will be generated at /root/initial_keyfile.bin
    [4] Power conditions are satisfied (i.e. your laptop is not running off battery)
    [5] You have a backup of all important data on /dev/sdh2

    /dev/sdh2: 2512 MiB = 2.5 GiB
    Chunk size: 10485760 bytes = 10.0 MiB
    Keyfile: /root/initial_keyfile.bin
    LUKS format parameters: -h,sha256

Are all these conditions satisfied, then answer uppercase yes: YES
[I]: Created raw device alias: /dev/sdh2 -&gt; /dev/mapper/alias_luksipc_raw_60377226
[I]: Size of reading device /dev/mapper/oldluks is 2631925760 bytes (2510 MiB + 0 bytes)
[I]: Backing up physical disk /dev/sdh2 header to backup file header_backup.img
[I]: Performing luksFormat of /dev/sdh2
[I]: Performing luksOpen of /dev/sdh2 (opening as mapper name luksipc_dbb86eda)
[I]: Size of luksOpened writing device is 2631925760 bytes (2510 MiB + 0 bytes)
[I]: Write disk size equal to read disk size.
[I]: Starting copying of data, read offset 10485760, write offset 0
[I]:  0:00:   4.4%       110 MiB / 2510 MiB    43.5 MiB/s   Left:    2400 MiB  0:00 h:m
[I]:  0:00:   8.4%       210 MiB / 2510 MiB    34.1 MiB/s   Left:    2300 MiB  0:01 h:m
[I]:  0:00:  12.4%       310 MiB / 2510 MiB    21.9 MiB/s   Left:    2200 MiB  0:01 h:m
[...]
[I]:  0:02:  88.0%      2210 MiB / 2510 MiB    17.3 MiB/s   Left:     300 MiB  0:00 h:m
[I]:  0:02:  92.0%      2310 MiB / 2510 MiB    17.6 MiB/s   Left:     200 MiB  0:00 h:m
[I]:  0:02:  96.0%      2410 MiB / 2510 MiB    18.0 MiB/s   Left:     100 MiB  0:00 h:m
[I]:  0:02: 100.0%      2510 MiB / 2510 MiB    18.2 MiB/s   Left:       0 MiB  0:00 h:m
[I]: Disk copy completed successfully.
[I]: Synchronizing disk...
[I]: Synchronizing of disk finished.
</pre></div>
</div>
<p>After the process has finished, the old LUKS device /dev/mapper/oldluks will
still be open. Be very careful not to do anything with that device, however!
It&#8217;s safe to close it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># cryptsetup luksClose oldluks</span>
</pre></div>
</div>
<p>Then, let&#8217;s open the device with the new key:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># cryptsetup luksOpen /dev/sdh2 newluks -d /root/initial_keyfile.bin</span>
</pre></div>
</div>
<p>And check that the conversion worked:</p>
<div class="highlight-python"><div class="highlight"><pre># md5sum /dev/mapper/newluks
48d9763be76ddb4fb990367f8d6b8c22  /dev/mapper/newluks
</pre></div>
</div>
<p>Which it did :-)</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="problems.html" class="btn btn-neutral float-right" title="Conversion problems" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="introduction.html" class="btn btn-neutral" title="Introduction" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Johannes Bauer.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.04',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>